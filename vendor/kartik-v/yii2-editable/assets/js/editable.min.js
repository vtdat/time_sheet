/*!
 * @package   yii2-editable
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2015
 * @version   1.7.3
 *
 * Editable Extension jQuery plugin
 *
 * Built for Yii Framework 2.0
 * Author: Kartik Visweswaran
 * Year: 2015
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){"use strict";var t=function(t,i){return null===t||void 0===t||0===t.length||i&&""===e.trim(t)},i=function(e,t){e.removeClass(t).addClass(t)},n=function(t,i){var n=this;n.$container=e(t),n.init(i),n.listen()};n.prototype={constructor:n,init:function(t){var i=this,n=i.$container;i.$input=n.find(".kv-editable-input"),i.$form=n.find(".kv-editable-form"),i.$value=n.find(".kv-editable-value"),i.$close=n.find(".kv-editable-close"),i.$popover=n.find(".kv-editable-popover"),i.$inline=n.find(".kv-editable-inline"),i.$btnSubmit=n.find("button.kv-editable-submit"),i.$btnReset=n.find("button.kv-editable-reset"),i.$loading=n.find(".kv-editable-loading"),i.$target=n.find(t.target),e.each(t,function(e,t){i[e]=t}),i.asPopover=1==i.asPopover||"true"===i.asPopover},toggle:function(e,t){var n=this,o=n.$value,r=n.$inline;return t=t||"fast",e?void(n.asPopover||o.fadeOut(t,function(){r.fadeIn(t),".kv-editable-button"===n.target&&i(n.$target,"kv-inline-open")})):void(n.asPopover?n.$popover.popoverX("hide"):r.fadeOut(t,function(){o.fadeIn(t),n.$target.removeClass("kv-inline-open")}))},refreshPopover:function(){var e=this;e.asPopover&&e.$popover.popoverX("refreshPosition")},listen:function(){var n,o,r=this,a=r.$form,l=r.$btnSubmit,s=r.$btnReset,v=a.parent(),d=r.$container,c=(r.$popover,r.$close),u=".kv-editable-button"===r.target?r.$target:r.$value,f=r.$inline,p=r.$loading,h=r.$input,b="",g="",m=h.closest(".field-"+h.attr("id")),k=h.closest(".kv-editable-parent"),$=m.find(".help-block"),y=r.displayValueConfig,C=a.find('input[name="hasEditable"]'),P=k.find(".kv-help-block"),E=r.$form.data("yiiActiveForm"),j=t(m.attr("class"))||t($.attr("class"));n=function(n){j?(t(P.attr("class"))&&(P=e(document.createElement("div")).attr({"class":"help-block kv-help-block"}).appendTo(k)),P.html(n)):($.html(n),i($,"kv-help-block")),i(k,"has-error"),p.hide(),v.removeClass("kv-editable-processing")},a.on("submit",function(e){e.preventDefault()}).on("keyup",function(e){13===e.which&&r.submitOnEnter&&l.trigger("click")}).on("reset",function(){setTimeout(function(){a.data("kvEditableSubmit",!1),j?(k.find(".help-block").remove(),k.removeClass("has-error")):(m.removeClass("has-error"),$.html(" ")),r.refreshPopover()},200)}),a.find("input, select").on("change",function(){r.refreshPopover(),d.trigger("editableChange",[h.val()])}),s.on("click",function(){C.val(0),setTimeout(function(){a[0].reset()},200),d.trigger("editableReset")}),c.on("click",function(){r.toggle(!1)}),u.on("click",function(){if(r.asPopover)return void r.toggle(!0);var e=!r.$inline.is(":visible");r.toggle(e)}),l.on("click",function(){var l=r.asPopover?v:f;i(l,"kv-editable-processing"),p.show(),C.val(1),a.find(".help-block").each(function(){e(this).html("")}),a.find("input, select").each(function(){e(this).trigger("change")}),o=e.extend({type:a.attr("method"),url:a.attr("action"),data:a.serialize(),dataType:"json",error:function(e,t,i){r.showAjaxErrors&&n(i),d.trigger("editableAjaxError",[e,t,i])},success:function(i){return b="",g=t(i.output)?h.val():i.output,r.refreshPopover(),t(i.message)?(t(P.attr("class"))||(m.removeClass("has-error"),P.html("").hide(),$.html("")),a.find(".help-block").each(function(){var i=e(this).text();b+=i?i.trim():"",t(b)||p.hide()}),t(b)?(p.hide(),t(g)?g=r.valueIfNull:void 0!==y[g]&&(g=y[g]),j?(k.find(".help-block").remove(),k.removeClass("has-error"),$.html(""),r.toggle(!1),r.$value.html(g)):(m.removeClass("has-error"),$.html(""),r.toggle(!1),r.$value.html(g),E&&(a.yiiActiveForm("destroy"),a.yiiActiveForm(E.attributes,E.settings))),d.trigger("editableSuccess",[h.val(),a,i])):d.trigger("editableError",[h.val(),a,i]),void l.removeClass("kv-editable-processing")):(n(i.message),void d.trigger("editableError",[h.val(),a,i]))}},r.ajaxSettings),e.ajax(o),d.trigger("editableSubmit",[h.val(),a])})}},e.fn.editable=function(t){var i=Array.apply(null,arguments);return i.shift(),this.each(function(){var o=e(this),r=o.data("editable"),a="object"==typeof t&&t;r||(r=new n(this,e.extend({},e.fn.editable.defaults,a,e(this).data())),o.data("editable",r)),"string"==typeof t&&r[t].apply(r,i)})},e.fn.editable.defaults={valueIfNull:"<em>(not set)</em>",placement:"right",displayValueConfig:{},ajaxSettings:{},showAjaxErrors:!0,submitOnEnter:!0,asPopover:!0},e.fn.editable.Constructor=n}(window.jQuery);